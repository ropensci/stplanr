<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Convert flow data to SpatialLinesDataFrame — od2line • stplanr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Convert flow data to SpatialLinesDataFrame — od2line" />

<meta property="og:description" content="Origin-destination ('OD') flow data is often provided
in the form of 1 line per flow with zone codes of origin and destination
centroids. This can be tricky to plot and link-up with geographical data.
This function makes the task easier." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stplanr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.7.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stplanr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/stplanr-paper.html">stplanr: A Package for Transport Planning</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert flow data to SpatialLinesDataFrame</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/stplanr/blob/master/R/od-funs.R'><code>R/od-funs.R</code></a></small>
    <div class="hidden name"><code>od2line.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Origin-destination ('OD') flow data is often provided
in the form of 1 line per flow with zone codes of origin and destination
centroids. This can be tricky to plot and link-up with geographical data.
This function makes the task easier.</p>
    
    </div>

    <pre class="usage"><span class='fu'>od2line</span>(<span class='no'>flow</span>, <span class='no'>zones</span>, <span class='kw'>destinations</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>zone_code</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/names'>names</a></span>(<span class='no'>zones</span>)[<span class='fl'>1</span>],
  <span class='kw'>origin_code</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/names'>names</a></span>(<span class='no'>flow</span>)[<span class='fl'>1</span>], <span class='kw'>dest_code</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/names'>names</a></span>(<span class='no'>flow</span>)[<span class='fl'>2</span>],
  <span class='kw'>zone_code_d</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>od2line2</span>(<span class='no'>flow</span>, <span class='no'>zones</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>flow</th>
      <td><p>A data frame representing the flow between two points
or zones. The first two columns of this data frame should correspond
to the first column of the data in the zones. Thus in <code><a href='cents.html'>cents()</a></code>,
the first column is geo_code. This corresponds to the first two columns
of <code><a href='flow.html'>flow()</a></code>.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p>A spatial object representing origins (and destinations
if no separate destinations object is provided) of travel.</p></td>
    </tr>
    <tr>
      <th>destinations</th>
      <td><p>A SpatialPolygonsDataFrame or SpatialPointsDataFrame
representing destinations of travel flows.</p></td>
    </tr>
    <tr>
      <th>zone_code</th>
      <td><p>Name of the variable in <code>zones</code> containing the ids of the zone.
By default this is the first column names in the zones.</p></td>
    </tr>
    <tr>
      <th>origin_code</th>
      <td><p>Name of the variable in <code>flow</code> containing the ids of the zone of origin.
By default this is the first column name in the flow input dataset.</p></td>
    </tr>
    <tr>
      <th>dest_code</th>
      <td><p>Name of the variable in <code>flow</code> containing the ids of the zone of destination.
By default this is the second column name in the flow input dataset or the first column name in the
destinations if that is set.</p></td>
    </tr>
    <tr>
      <th>zone_code_d</th>
      <td><p>Name of the variable in <code>destinations</code> containing the ids of the zone.
By default this is the first column names in the destinations.</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>TRUE by default, setting it to TRUE will show you the matching columns</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function expects zone codes to be in the 1st column of the zones/destinations
datasets and the 1st and 2nd columns of the flow data, respectively.</p>
<p><code>od2line2()</code> is a faster implementation
(around 6 times faster on large datasets)
that returns a <code>SpatialLines</code> object, omitting the data and working
only when there is no destinations dataset (i.e. when the geography of
origins is the same as that of destinations).</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>l</span> <span class='kw'>&lt;-</span> <span class='fu'>od2line</span>(<span class='kw'>flow</span> <span class='kw'>=</span> <span class='no'>flow</span>, <span class='kw'>zones</span> <span class='kw'>=</span> <span class='no'>cents</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>cents</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>l</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>l</span>$<span class='no'>All</span> / <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>l</span>$<span class='no'>All</span>), <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='od2line-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># When destinations are different</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='no'>flow_dests</span>[<span class='fl'>1</span>:<span class='fl'>5</span>]) <span class='co'># check data</span></div><div class='output co'>#&gt;        Area.of.residence    WZ11CD All Work.mainly.at.or.from.home
#&gt; 920573         E02002361 E33010350 109                           0
#&gt; 920575         E02002361 E33010390  38                           0
#&gt; 920578         E02002361 E33010468  10                           0
#&gt; 920582         E02002361 E33012367  44                           0
#&gt; 920587         E02002361 E33012225  34                           0
#&gt; 920591         E02002361 E33012368   7                           0
#&gt;        Underground..metro..light.rail..tram
#&gt; 920573                                    0
#&gt; 920575                                    0
#&gt; 920578                                    0
#&gt; 920582                                    0
#&gt; 920587                                    0
#&gt; 920591                                    0</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='no'>destinations</span>[<span class='fl'>1</span>:<span class='fl'>5</span>])</div><div class='output co'>#&gt; class       : SpatialPointsDataFrame 
#&gt; features    : 6 
#&gt; extent      : -1.540901, -1.492713, 53.80131, 53.81724  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
#&gt; variables   : 5
#&gt; names       :    WZ11CD,   LAD11CD, COWZEW_SG,                     COWZEW_SGN, COWZEW_G 
#&gt; min values  : E33010351, E08000035,         2, Manufacturing and distribution,       2c 
#&gt; max values  : E33012352, E08000035,         7,                       Top jobs,       7c </div><div class='input'><span class='no'>flowlines_dests</span> <span class='kw'>&lt;-</span> <span class='fu'>od2line</span>(<span class='no'>flow_dests</span>, <span class='no'>cents</span>, <span class='kw'>destinations</span> <span class='kw'>=</span> <span class='no'>destinations</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>flowlines_dests</span>)</div><div class='img'><img src='od2line-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='no'>l</span> <span class='kw'>&lt;-</span> <span class='fu'>od2line</span>(<span class='no'>flow</span>, <span class='no'>zones_sf</span>)</div><div class='output co'>#&gt; <span class='message'>Creating centroids representing desire line start and end points.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>l</span>[<span class='st'>"All"</span>], <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>l</span>$<span class='no'>All</span>/<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>l</span>$<span class='no'>All</span>))</div><div class='img'><img src='od2line-3.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Robin Lovelace, Richard Ellison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

