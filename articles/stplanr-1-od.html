<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Origin-destination data in R: examples with stplanr • stplanr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css" rel="stylesheet">
<meta property="og:title" content="Origin-destination data in R: examples with stplanr">
<meta property="og:description" content="">
<meta property="og:image" content="https://ropensci.github.io/stplanr/logo.png">
<meta name="twitter:card" content="summary">
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="../hexlogo.png" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>stplanr <small>v0.2.9.9000</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stplanr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stplanr-1-od.html">Origin-destination data in R: examples with stplanr</a>
    </li>
    <li>
      <a href="../articles/stplanr-paper.html">stplanr: A Package for Transport Planning</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Origin-destination data in R: examples with stplanr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/stplanr/blob/master/vignettes/stplanr-1-od.Rmd"><code>vignettes/stplanr-1-od.Rmd</code></a></small>
      <div class="hidden name"><code>stplanr-1-od.Rmd</code></div>

    </div>

    
    
<div id="introduction-what-is-od-data" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-what-is-od-data" class="anchor"></a>Introduction: what is OD data?</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(stplanr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; Registered S3 method overwritten by 'R.oo':</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt;   method        from       </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt;   throw.default R.methodsS3</span></a></code></pre></div>
</div>
<div id="representations-of-od-data" class="section level1">
<h1 class="hasAnchor">
<a href="#representations-of-od-data" class="anchor"></a>Representations of OD data</h1>
<div id="origin-destination-pairs-long-form" class="section level2">
<h2 class="hasAnchor">
<a href="#origin-destination-pairs-long-form" class="anchor"></a>Origin-destination pairs (long form)</h2>
<p>Perhaps the most common and straightforward representation of OD data is a ‘long thin’ data frame. This is increasingly the format used by official statistical agencies, including the UK’s Office for National Statistics (ONS), who provide origin destination data as a <code>.csv</code> file. Typically, the first column is the zone code of origin and the second column is the zone code of the destination, as shown in the code chunk below, which creates an object called <code>od_data_sample</code> using the <a href="https://itsleeds.github.io/pct/"><code>pct</code> package</a> (chunk not evaluated for speed):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"ITSLeeds/pct"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(pct)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">od_data_all =<span class="st"> </span>pct<span class="op">::</span><span class="kw">get_od</span>()</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">sel_local =<span class="st"> </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span>od_data_all<span class="op">$</span>geo_code1 <span class="op">%in%</span><span class="st"> </span>cents_sf<span class="op">$</span>geo_code <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span>od_data_all<span class="op">$</span>geo_code2 <span class="op">%in%</span><span class="st"> </span>cents_sf<span class="op">$</span>geo_code </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">od_data_sample =<span class="st"> </span>od_data_all[sel_local, ]</a></code></pre></div>
<p>Data in this form usually has at least one other colum, representing the amount of travel between the zones. Additional columns represent addition attributes, e.g. a breakdown of flow by time, mode of travel, type of person, or trip purpose. As shown in the output of printing the sample dataset, the dataset we have downloaded contains column names representing mode of travel (car, bicycle etc):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(od_data_sample)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;  [1] "geo_code1"     "geo_code2"     "all"           "from_home"    </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;  [5] "light_rail"    "train"         "bus"           "taxi"         </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;  [9] "motorbike"     "car_driver"    "car_passenger" "bicycle"      </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; [13] "foot"          "other"         "geo_name1"     "geo_name2"    </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [17] "la_1"          "la_2"</span></a></code></pre></div>
<p>Each ‘mode’ column contains an integer, while additional columns contain characters, as demonstrated by printing the data frame:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">od_data_sample</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; # A tibble: 64 x 18</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt;    geo_code1 geo_code2   all from_home light_rail train   bus  taxi</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;  1 E02002361 E02002361   109         0          0     0     4     2</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;  2 E02002361 E02002363    38         0          0     1     4     1</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;  3 E02002361 E02002367    10         0          0     0     1     0</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  4 E02002361 E02002371    44         0          0     0     2     2</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  5 E02002361 E02002377    34         0          0     0     0     1</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  6 E02002361 E02002382     7         0          0     0     1     0</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  7 E02002361 E02002384    53         0          0     1    10     1</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  8 E02002361 E02002393    94         0          0     0    17     1</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  9 E02002363 E02002361    30         0          0     0     0     1</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; 10 E02002363 E02002363   183         0          0     2    13     3</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; # … with 54 more rows, and 10 more variables: motorbike &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; #   car_driver &lt;dbl&gt;, car_passenger &lt;dbl&gt;, bicycle &lt;dbl&gt;, foot &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; #   other &lt;dbl&gt;, geo_name1 &lt;chr&gt;, geo_name2 &lt;chr&gt;, la_1 &lt;chr&gt;, la_2 &lt;chr&gt;</span></a></code></pre></div>
</div>
<div id="origin-destination-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#origin-destination-matrices" class="anchor"></a>Origin destination matrices</h2>
</div>
<div id="desire-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#desire-lines" class="anchor"></a>Desire lines</h2>
<p>The previous two representations of OD data are ‘implicitly geographic’: their coordinates are not contained in the data, but associated with another data object, typically a zone or a zone centroid. This is clearly problematic because it makes OD data less modular and self standing. A useful way of representing OD data that overcomes this issue is <code>desire_line</code> data: geographic lines between origin and destination, with information on flow levels between the two.</p>
<p>This is represented in the file <code>lines_cars.Rds</code>, representing the top 20,000 desire lines at the MSOA-MSOA level in England and Wales by the number of car km used for travel to work, which can be downloaded, read-in and plotted as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">u =<span class="st"> "https://github.com/ropensci/stplanr/releases/download/0.2.9/lines_cars.Rds"</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">f =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempdir</a></span>(), <span class="st">"lines_cars.Rds"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(u, f)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">lines_cars =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(f)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(lines_cars[<span class="st">"car_km"</span>], <span class="dt">lwd =</span> lines_cars<span class="op">$</span>car_km <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>)</a></code></pre></div>
<p><img src="stplanr-1-od_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>Based on the estimate of the average energy use per km being 2.5 MJ, and that these return trips are made on average 200 times per year, with a circuity of 1.3, we can estimate the total energy use of the ‘high energy commutes’ as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(lines_cars<span class="op">$</span>car_km <span class="op">*</span><span class="st"> </span><span class="fl">2.5</span> <span class="op">*</span><span class="st"> </span><span class="dv">200</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [1] 10.62515</span></a></code></pre></div>
<p>That represents ~10 petajoules (PJ), only for the top 20,000 most energy intensive commutes. That may seem like alot, but represents only a fraction of the UK’s total energy use of <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/729451/DUKES_PN.pdf">~200 Mtoe</a> (8400 PJ).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-what-is-od-data">Introduction: what is OD data?</a></li>
      <li>
<a href="#representations-of-od-data">Representations of OD data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#origin-destination-pairs-long-form">Origin-destination pairs (long form)</a></li>
      <li><a href="#origin-destination-matrices">Origin destination matrices</a></li>
      <li><a href="#desire-lines">Desire lines</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div style="margin-top:-9px">
  <p>stplanr is a part of <img src="https://github.com/ropensci/logos/raw/master/icon_lettering_color.png" height="40" alt="rOpenSci">. Learn more at <a href="https://ropensci.org">ropensci.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by Robin Lovelace, Richard Ellison, Malcolm Morgan.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a> &amp; <a href="https://ropensci.github.io/rotemplate/">rotemplate</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
